<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SenangWebs One</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#00FF99',
                        secondary: '#007370',
                        dark: '#18181B',
                        darker: '#09090B',
                    }
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/hopscotch.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet" />
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-html.min.js"></script>

    <style>
        .CodeMirror {
            height: 100%;
            font-size: 14px;
            line-height: 1.5;
        }
        body {
            overflow: hidden;
            font-family: 'Outfit', sans-serif;
        }
        .CodeMirror-scrollbar-filler{
            opacity: 0!important;
        }
        .CodeMirror-vscrollbar::-webkit-scrollbar,
        #console-output::-webkit-scrollbar {
            width: 8px;
        }
        .CodeMirror-hscrollbar::-webkit-scrollbar,
        #console-output::-webkit-scrollbar {
            height: 8px;
        }
        .CodeMirror-vscrollbar::-webkit-scrollbar-track,
        .CodeMirror-hscrollbar::-webkit-scrollbar-track,
        #console-output::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        .CodeMirror-vscrollbar::-webkit-scrollbar-thumb,
        .CodeMirror-hscrollbar::-webkit-scrollbar-thumb,
        #console-output::-webkit-scrollbar-thumb {
            background: #4a5568; /* gray-600 */
            border-radius: 4px;
        }
        .CodeMirror-vscrollbar::-webkit-scrollbar-thumb:hover,
        .CodeMirror-hscrollbar::-webkit-scrollbar-thumb:hover,
        #console-output::-webkit-scrollbar-thumb:hover {
            background: #718096; /* gray-500 */
        }
        /* Ensure panes don't shrink below their content if min-width is not 0 for flex items */
        #editor-pane, #right-pane {
            min-width: 0;
        }
    </style>
</head>
<body class="bg-darker text-white">
    <main class="flex flex-col h-screen">
        <section id="panelEditor" class="flex flex-grow p-2 h-[calc(100%-3rem)]">
            <!-- Editor Pane -->
            <div id="editor-pane" class="h-full flex flex-col rounded-md overflow-hidden bg-neutral-800 border border-white/10 code-editor-ui relative" style="flex-shrink: 0;">
                <div class="flex-grow h-[calc(100%-4rem)]">
                    <textarea id="code-editor"></textarea>
                </div>
                <button id="code-prettier-btn" class="top-2 right-4 absolute bg-black opacity-70 hover:opacity-100 text-xs font-mono font-bold rounded-full px-2 py-1">PRETTIER</button>
            </div>
    
            <!-- Resize Handle -->
            <div id="resize-handle" class="w-2 h-full bg-transparent cursor-col-resize flex-shrink-0 code-editor-ui"></div>
    
            <!-- Right Pane (Preview + Console) -->
            <div id="right-pane" class="h-full flex flex-col flex-grow relative">
                <!-- Preview Pane -->
                <div id="preview-pane-container" class="flex flex-col flex-grow justify-center bg-darker">
                    <div id="preview-devices-container" class="bg-white mx-auto rounded-md overflow-hidden" style="width: 100%; height: 100%;">
                        <iframe id="preview-frame" class="w-full h-full border-0" sandbox="allow-scripts allow-popups allow-forms"></iframe>
                    </div>
                </div>

                <!-- Resize Handle Console -->
                <div id="resize-handle-console" class="h-2 w-full bg-transparent cursor-row-resize flex-shrink-0 console-ui"></div>
    
                <!-- Console Pane -->
                <div id="console-container" class="bg-dark border border-white/10 flex flex-col rounded-md overflow-hidden console-ui">
                    <div class="bg-white/10 pl-3 p-2 text-sm font-semibold h-10 flex justify-between items-center">
                        <span class="font-mono">Console</span>
                        <button id="clear-console-btn" class="text-xs bg-neutral-700 hover:bg-neutral-600 px-2 py-1 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">Clear</button>
                    </div>
                    <div id="console-output" class="flex-grow p-2 overflow-y-auto text-xs font-mono">
                        <!-- Console messages will appear here -->
                    </div>
                </div>
    
                <div id="preview-frame-cover-resizeable" class="absolute w-full h-full bg-black opacity-0 z-50 hidden"></div>
            </div>
        </section>
        <section id="panelControl" class="flex justify-between h-12 bg-dark text-neutral-400 text-sm">
            <div class="flex">
                <button class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="resizePreviewDevice('100%', '100%')">
                    <i class="fas fa-desktop"></i>
                </button>
                <button class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="resizePreviewDevice('1070px', '100%')">
                    <i class="fas fa-tablet-alt"></i>
                </button>
                <button class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="resizePreviewDevice('390px', '844px')">
                    <i class="fas fa-mobile-alt"></i>
                </button>
            </div>
            <div class="flex">
                <button class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="updatePreview()">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="openPreviewInNewTab()">
                    <i class="fas fa-bolt"></i>
                </button>
                <button class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="alert('open sharing modal')">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>
            <div class="flex">
                <button id="toggle-code-editor-btn" class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="toggleCodeEditor()">
                    <i class="fas fa-code"></i>
                </button>
                <button id="toggle-console-btn" class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="toggleConsole()">
                    <i class="fas fa-terminal"></i>
                </button>
                <button class="w-12 h-12 flex items-center justify-center hover:bg-black hover:bg-opacity-20 hover:text-primary" onclick="alert('menu')">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editorTextArea = document.getElementById('code-editor');
            const previewFrame = document.getElementById('preview-frame');
            const consoleOutput = document.getElementById('console-output');
            const clearConsoleBtn = document.getElementById('clear-console-btn');

            const editorPane = document.getElementById('editor-pane');
            const rightPane = document.getElementById('right-pane');
            const resizeHandle = document.getElementById('resize-handle');
            const previewFrameCover = document.getElementById('preview-frame-cover-resizeable');
            
            const resizeHandleConsole = document.getElementById('resize-handle-console');
            const previewPaneContainer = document.getElementById('preview-pane-container');
            const consoleContainer = document.getElementById('console-container');

            const toggleConsoleBtn = document.getElementById('toggle-console-btn');
            const toggleCodeEditorBtn = document.getElementById('toggle-code-editor-btn');
            const codePrettierBtn = document.getElementById('code-prettier-btn'); // Get the prettier button

            const previewDevicesContainer = document.getElementById('preview-devices-container'); 

            const activeClasses = ['bg-black', 'bg-opacity-20', 'text-primary'];

            function updateButtonActiveState(button, isActive) {
                if (isActive) {
                    button.classList.add(...activeClasses);
                } else {
                    button.classList.remove(...activeClasses);
                }
            }

            editorPane.style.width = '50%';

            const consoleElements = document.getElementsByClassName('console-ui');
            Array.from(consoleElements).forEach(element => {
                element.style.display = 'none';
            });
            updateButtonActiveState(toggleConsoleBtn, false); 

            previewPaneContainer.style.height = `${rightPane.offsetHeight}px`;
            updateButtonActiveState(toggleCodeEditorBtn, editorPane.style.display !== 'none');

            const initialCode = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Preview</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; color: #333; padding: 20px; margin: 0; }
        h1 { color: steelblue; }
        button { background-color: steelblue; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        button:hover { background-color: darkslateblue; }
        .output { margin-top: 10px; padding: 10px; border: 1px solid #ccc; background-color: #fff; min-height: 20px; }
        .note { font-size: 0.9em; color: #555; margin-top:15px; }
    </style>
</head>
<body>
    <h1>Hello Resizable World!</h1>
    <p>Check the console below the preview for messages. Try resizing the panes!</p>
    <button id="testBtn">Log Message</button>
    <button id="errorBtn">Log Error</button>
    <div id="outputDiv" class="output"></div>
    <p class="note"><code>localStorage</code>, <code>alert</code>, etc., are restricted by the sandbox.</p>
    <script>
        console.log("Iframe script loaded!", { a: 1, b: "text" });
        console.warn("This is a warning from iframe.");
        const testBtn = document.getElementById('testBtn');
        const errorBtn = document.getElementById('errorBtn');
        const outputDiv = document.getElementById('outputDiv');
        let clickCount = 0;
        if (testBtn) {
            testBtn.addEventListener('click', () => {
                clickCount++;
                const complexObject = { id: clickCount, timestamp: new Date() };
                console.log("Button clicked:", clickCount, "times.", complexObject);
                if(outputDiv) outputDiv.textContent = "Logged to console. Click: " + clickCount;
            });
        }
        if (errorBtn) {
            errorBtn.addEventListener('click', () => {
                console.error("This is a test error!", new Error("Something went wrong"));
            });
        }
    <\/script>
</body>
</html>`;

            editorTextArea.value = initialCode;

            const cmEditor = CodeMirror.fromTextArea(editorTextArea, {
                mode: 'htmlmixed',
                theme: 'hopscotch',
                lineNumbers: true,
                autoCloseTags: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                tabSize: 2,
                indentUnit: 2,
            });

            // Add click listener for the code prettier button
            if (codePrettierBtn) {
                if (typeof html_beautify === 'function') {
                    codePrettierBtn.addEventListener('click', () => {
                        const currentCode = cmEditor.getValue();
                        const options = {
                            // preserve_newlines: true, // Default is true
                            // max_preserve_newlines: 1, // Example: limit blank lines
                            wrap_line_length: 0, // 0 to disable line wrapping by beautifier
                            // unformatted: ['a', 'span', 'img', 'code', 'pre'], // tags that shouldn't be reformatted
                            // indent_scripts: "keep" // "normal" or "separate"
                        };

                        if (cmEditor.getOption("indentWithTabs")) {
                            options.indent_with_tabs = true;
                        } else {
                            options.indent_with_tabs = false;
                            options.indent_size = cmEditor.getOption("indentUnit") || 2;
                            options.indent_char = ' ';
                        }
                        
                        try {
                            const formattedCode = html_beautify(currentCode, options);
                            cmEditor.setValue(formattedCode);
                        } catch (e) {
                            console.error("Error during code formatting with js-beautify:", e);
                            alert("Could not format the code. Check console for errors.");
                        }
                    });
                } else {
                    // js-beautify not loaded
                    codePrettierBtn.disabled = true;
                    codePrettierBtn.title = "Formatting library (js-beautify) not loaded";
                    codePrettierBtn.style.opacity = '0.5';
                    console.warn('html_beautify function not found. The "Prettier" button will be disabled. Make sure js-beautify library is loaded.');
                }
            }


            const iframeConsoleBridgeScript = `
<script id="iframe-console-bridge">
(function() {
    'use strict';
    const originalConsole = {};
    const methods = ['log', 'error', 'warn', 'info', 'debug', 'clear'];
    methods.forEach(method => {
        originalConsole[method] = console[method] ? console[method].bind(console) : () => {};
    });
    function formatArgsForPostMessage(args) {
        return Array.from(args).map(arg => {
            if (arg instanceof Error) return \`Error: \${arg.message}\${arg.stack ? \`\nStack: \${arg.stack}\` : ''}\`;
            if (arg instanceof HTMLElement) {
                let attrs = Array.from(arg.attributes).map(attr => \`\${attr.name}="\${attr.value}"\`).join(' ');
                return \`<\${arg.tagName.toLowerCase()}\${attrs ? ' ' + attrs : ''}>...\`;
            }
            if (typeof arg === 'function') return '[Function]';
            if (typeof arg === 'symbol') return arg.toString();
            if (typeof arg === 'object' && arg !== null) {
                try {
                    const cache = new Set();
                    return JSON.stringify(arg, (key, value) => {
                        if (typeof value === 'object' && value !== null) {
                            if (cache.has(value)) return '[Circular Reference]';
                            cache.add(value);
                        }
                        if (value instanceof HTMLElement) return \`<\${value.tagName.toLowerCase()}> (embedded HTML Element)\`;
                        return value;
                    }, 2);
                } catch (e) { return '[Unserializable Object]'; }
            }
            return String(arg);
        });
    }
    const isNotInTopWindow = window.self !== window.top;

    methods.forEach(methodName => {
        if (methodName === 'clear') {
            console.clear = function() {
                if (originalConsole.clear) originalConsole.clear();
                if (isNotInTopWindow) {
                    try { window.parent.postMessage({ type: 'iframe-console', method: 'clear' }, '*'); }
                    catch(e) { if(originalConsole.error) originalConsole.error('Console bridge error (clear):', e); }
                }
            };
        } else {
            console[methodName] = function(...args) {
                if (originalConsole[methodName]) originalConsole[methodName](...args);
                if (isNotInTopWindow) {
                    try { window.parent.postMessage({ type: 'iframe-console', method: methodName, args: formatArgsForPostMessage(args) }, '*'); }
                    catch(e) { if(originalConsole.error) originalConsole.error('Console bridge error ('+methodName+'):', e); }
                }
            };
        }
    });
    window.addEventListener('error', function(event) {
        const errorArgs = [\`Unhandled error: \${event.message}\`, \`at \${event.filename || 'unknown'}:\${event.lineno || 0}:\${event.colno || 0}\`];
        if (originalConsole.error) originalConsole.error(...errorArgs);
        if (isNotInTopWindow) {
            try { window.parent.postMessage({ type: 'iframe-console', method: 'error', args: errorArgs }, '*'); }
            catch(e) { if(originalConsole.error) originalConsole.error('Console bridge error (onerror):', e); }
        }
    });
    window.addEventListener('unhandledrejection', function(event) {
        const reason = event.reason instanceof Error ? \`\${event.reason.message}\n\${event.reason.stack}\` : String(event.reason);
        const rejectionArgs = ['Unhandled promise rejection:', reason];
        if (originalConsole.warn) originalConsole.warn(...rejectionArgs);
        if (isNotInTopWindow) {
            try { window.parent.postMessage({ type: 'iframe-console', method: 'warn', args: rejectionArgs }, '*'); }
            catch(e) { if(originalConsole.error) originalConsole.error('Console bridge error (unhandledrejection):', e); }
        }
    });
    if (isNotInTopWindow) {
        setTimeout(() => {
            try { 
                window.parent.postMessage({ type: 'iframe-ready' }, '*');
                if (originalConsole.log) originalConsole.log("Console bridge initialized in iframe.");
            } catch(e) { if(originalConsole.error) originalConsole.error('Console bridge error (ready):', e); }
        }, 0);
    } else {
        if (originalConsole.log) originalConsole.log("Preview loaded in new tab. Console bridge active for local logging.");
    }
})();
<\/script>
`;

            function updatePreview() {
                const userCode = cmEditor.getValue();
                const fullCode = iframeConsoleBridgeScript + userCode;
                if (previewFrame) {
                    previewFrame.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(fullCode);
                }
            }
            window.updatePreview = updatePreview;

            function openPreviewInNewTab() {
                const userCode = cmEditor.getValue();
                const fullCode = iframeConsoleBridgeScript + userCode;
                
                const blob = new Blob([fullCode], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                const newTab = window.open(url, '_blank');
                
                if (newTab) {
                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                    }, 5000); 
                } else {
                    URL.revokeObjectURL(url); 
                    alert('Popup blocked! Please allow popups for this site to open the preview in a new tab.');
                }
            }
            window.openPreviewInNewTab = openPreviewInNewTab; 

            function resizePreviewDevice(width, height) {
                if (previewDevicesContainer) {
                    previewDevicesContainer.style.maxWidth = width;
                    previewDevicesContainer.style.height = height;
                    if (width !== '100%') {
                        previewDevicesContainer.style.margin = '0 auto';
                    } else {
                        previewDevicesContainer.style.margin = ''; 
                    }
                }
            }
            window.resizePreviewDevice = resizePreviewDevice;

            function toggleConsole() {
                const consoleElements = document.getElementsByClassName('console-ui');
                const consoleIsCurrentlyVisible = consoleContainer.style.display !== 'none';

                Array.from(consoleElements).forEach(element => {
                    element.style.display = consoleIsCurrentlyVisible ? 'none' : 'flex';
                });

                const isConsoleVisibleAfterToggle = !consoleIsCurrentlyVisible;
                updateButtonActiveState(toggleConsoleBtn, isConsoleVisibleAfterToggle);

                const rightPaneHeight = rightPane.offsetHeight;
                if (isConsoleVisibleAfterToggle) {
                    const resizeHandleConsoleHeight = resizeHandleConsole.offsetHeight;
                    previewPaneContainer.style.height = `${(rightPaneHeight - resizeHandleConsoleHeight) * 0.66}px`;
                    consoleContainer.style.height = `${(rightPaneHeight - resizeHandleConsoleHeight) * 0.34}px`;
                } else {
                    previewPaneContainer.style.height = `${rightPaneHeight}px`;
                }
            }
            window.toggleConsole = toggleConsole;

            function toggleCodeEditor() {
                const codeEditorElements = document.getElementsByClassName('code-editor-ui');
                let isEditorVisible = false;
                Array.from(codeEditorElements).forEach(element => {
                    const newDisplay = element.style.display === 'none' ? 'flex' : 'none';
                    element.style.display = newDisplay;
                    if (element === editorPane && newDisplay !== 'none') {
                        isEditorVisible = true;
                    }
                });
                updateButtonActiveState(toggleCodeEditorBtn, isEditorVisible);
            }
            window.toggleCodeEditor = toggleCodeEditor;

            let debounceTimeout;
            function debouncedUpdatePreview() {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(updatePreview, 300);
            }

            cmEditor.on('change', debouncedUpdatePreview);

            window.addEventListener('message', (event) => {
                if (event.source !== previewFrame.contentWindow || !event.data) return;
                const data = event.data;
                if (data.type === 'iframe-console') {
                    const messageLine = document.createElement('div');
                    messageLine.classList.add('p-1', 'border-b', 'border-neutral-700', 'flex', 'items-start');
                    let methodColor = 'text-neutral-300', methodIcon = 'âž¡ï¸';
                    switch (data.method) {
                        case 'error': methodColor = 'text-red-400'; methodIcon = 'âŒ'; break;
                        case 'warn': methodColor = 'text-yellow-400'; methodIcon = 'âš ï¸'; break;
                        case 'info': methodColor = 'text-blue-400'; methodIcon = 'â„¹ï¸'; break;
                        case 'debug': methodColor = 'text-purple-400'; methodIcon = 'ðŸž'; break;
                        case 'clear':
                            consoleOutput.innerHTML = '';
                            const clearedMsg = document.createElement('div');
                            clearedMsg.className = 'p-1 text-neutral-500 italic';
                            clearedMsg.textContent = 'Console cleared by iframe.';
                            consoleOutput.appendChild(clearedMsg);
                            consoleOutput.scrollTop = consoleOutput.scrollHeight;
                            return;
                    }
                    messageLine.classList.add(methodColor);
                    const iconSpan = document.createElement('span');
                    iconSpan.className = 'mr-2 select-none'; iconSpan.textContent = methodIcon;
                    messageLine.appendChild(iconSpan);
                    const contentWrapper = document.createElement('div');
                    contentWrapper.className = 'flex-grow';
                    if (data.args && data.args.length > 0) {
                        const messageContent = document.createElement('pre');
                        messageContent.className = 'whitespace-pre-wrap break-words';
                        messageContent.textContent = data.args.join(' ');
                        contentWrapper.appendChild(messageContent);
                    } else {
                        const emptyMsg = document.createElement('span');
                        emptyMsg.textContent = (data.method === 'log') ? '(empty log)' : `(${data.method} with no arguments)`;
                        emptyMsg.className = 'italic opacity-70';
                        contentWrapper.appendChild(emptyMsg);
                    }
                    messageLine.appendChild(contentWrapper);
                    consoleOutput.appendChild(messageLine);
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                } else if (data.type === 'iframe-ready') {
                    const readyMsg = document.createElement('div');
                    readyMsg.className = 'p-1 text-green-400 italic';
                    readyMsg.textContent = 'console connected.';
                    consoleOutput.appendChild(readyMsg);
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                }
            });

            clearConsoleBtn.addEventListener('click', () => {
                consoleOutput.innerHTML = '';
                const clearedMsg = document.createElement('div');
                clearedMsg.className = 'p-1 text-neutral-500 italic';
                clearedMsg.textContent = 'Console cleared by editor.';
                consoleOutput.appendChild(clearedMsg);
            });

            let isResizing = false;
            let initialMouseX = 0;
            let initialEditorWidth = 0;

            function handlePaneMouseMove(e) {
                if (!isResizing) return;
                const deltaX = e.clientX - initialMouseX;
                let newEditorWidth = initialEditorWidth + deltaX; 
                const totalWidth = editorPane.parentElement.offsetWidth;
                const handleWidth = resizeHandle.offsetWidth;
                const minPixelWidthEditor = Math.max(100, totalWidth * 0.15);
                const minPixelWidthRight = Math.max(100, totalWidth * 0.15);
                const maxPixelWidthEditor = totalWidth - minPixelWidthRight - handleWidth;
                newEditorWidth = Math.max(minPixelWidthEditor, Math.min(newEditorWidth, maxPixelWidthEditor));
                editorPane.style.width = `${newEditorWidth}px`;
            }

            function handlePaneMouseUp() {
                if (!isResizing) return;
                isResizing = false;
                if (previewFrameCover) {
                    previewFrameCover.classList.add('hidden');
                }
                document.body.style.cursor = 'default';
                document.body.style.userSelect = '';
                document.removeEventListener('mousemove', handlePaneMouseMove);
                document.removeEventListener('mouseup', handlePaneMouseUp);
            }

            resizeHandle.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isResizing = true;
                initialMouseX = e.clientX;
                initialEditorWidth = editorPane.offsetWidth;
                if (previewFrameCover) {
                    previewFrameCover.classList.remove('hidden');
                }
                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';
                document.addEventListener('mousemove', handlePaneMouseMove);
                document.addEventListener('mouseup', handlePaneMouseUp);
            });

            let isResizingConsole = false;
            let initialMouseYConsole = 0;
            let initialPreviewHeight = 0;

            function handleConsoleResizeMouseMove(e) {
                if (!isResizingConsole) return;
                const deltaY = e.clientY - initialMouseYConsole;
                let newPreviewHeightLocal = initialPreviewHeight + deltaY; 
                const totalHeight = rightPane.offsetHeight;
                const handleHeight = resizeHandleConsole.offsetHeight;
                const minPaneHeight = Math.max(50, totalHeight * 0.10);
                const maxPreviewHeightPossible = totalHeight - minPaneHeight - handleHeight;
                newPreviewHeightLocal = Math.max(minPaneHeight, Math.min(newPreviewHeightLocal, maxPreviewHeightPossible));
                const newConsoleHeight = totalHeight - newPreviewHeightLocal - handleHeight;
                previewPaneContainer.style.height = `${newPreviewHeightLocal}px`;
                consoleContainer.style.height = `${newConsoleHeight}px`;
            }

            function handleConsoleResizeMouseUp() {
                if (!isResizingConsole) return;
                isResizingConsole = false;
                if (previewFrameCover) {
                    previewFrameCover.classList.add('hidden');
                }
                document.body.style.cursor = 'default';
                document.body.style.userSelect = '';
                document.removeEventListener('mousemove', handleConsoleResizeMouseMove);
                document.removeEventListener('mouseup', handleConsoleResizeMouseUp);
            }

            resizeHandleConsole.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isResizingConsole = true;
                initialMouseYConsole = e.clientY;
                initialPreviewHeight = previewPaneContainer.offsetHeight;
                if (previewFrameCover) {
                    previewFrameCover.classList.remove('hidden');
                }
                document.body.style.cursor = 'row-resize';
                document.body.style.userSelect = 'none';
                document.addEventListener('mousemove', handleConsoleResizeMouseMove);
                document.addEventListener('mouseup', handleConsoleResizeMouseUp); 
            });

            debouncedUpdatePreview();
        });
    </script>
</body>
</html>